import streamlit as st

# ページの設定
st.set_page_config(page_title="LOEWE UPPM 逆引きツール", layout="centered")

# データセットの定義
perfumes = [
    {
        "name_jp": "ドーレ",
        "name_es": "Doré",
        "type": "スパイシー・ウッディ・アンバー",
        "story": "マドリードの象徴的なモダニズムの映画館『シネ・ドレ』のアーカイブ上映から着想を得た、心を揺さぶる魅力的な香り。パチョリのフローラル、アロマティック、ウッディなノートが響き合います。",
        "ingredients": ["シナモン", "ミルラ", "バニラ", "ナツメグ", "ロエベ アコード", "パチョリ"]
    },
    {
        "name_jp": "シベレス",
        "name_es": "La Bella Cibeles",
        "type": "フローラル・フルーティ",
        "story": "大地、農業、豊穣のシンボル。シベレス広場の噴水のように、喜びと新鮮さ、情熱にあふれた官能的な香り。アイリスやローズ、バニラが重なります。",
        "ingredients": ["ベルガモット", "レモン", "ジャスミン", "アイリス", "ローズ", "オレンジブロッサム", "バイオレット", "キャロット", "バニラ", "パチョリ", "ムスク"]
    },
    {
        "name_jp": "デボー",
        "name_es": "Debod",
        "type": "フローラル・ウッディ・アンバー",
        "story": "マドリードで最も神秘的なデボー神殿。夕日で空と水面が魔法のような赤に染まる瞬間を、ウードやサフランの希少な香りで表現しました。",
        "ingredients": ["ローズ", "ゼラニウム", "ジャスミン", "ラブダナム", "シプリオール", "ウード", "パチョリ", "ベチバー", "アンバー", "マンダリン", "ココナッツリーフ", "サフラン"]
    },
    {
        "name_jp": "マイリット",
        "name_es": "Mayrit",
        "type": "フローラル・ウッディ",
        "story": "アラブ時代のマドリードの呼び名。9世紀の堅牢な壁に守られた要塞都市の歴史を想起させる、オレンジブロッサムやアンバーの謎めいた香り。",
        "ingredients": ["オレンジブロッサム", "パッションフルーツ", "グレープフルーツ", "カルダモン", "ローズ", "ジャスミン", "アンバー", "サンダルウッド", "バニラ"]
    },
    {
        "name_jp": "オペラ",
        "name_es": "Ópera",
        "type": "フローラル・パウダリー・ウッディ",
        "story": "フェリペ2世の宮廷文化。劇場や音楽の調べに包まれるような、エレガントで夢見心地なひととき。スズランやサンダルウッドが優雅に漂います。",
        "ingredients": ["ベルガモット", "スズラン", "フリージア", "ローズ", "ジャスミン", "バニラ", "ベンゾイン", "ベチバー", "サンダルウッド", "ムスク"]
    },
    {
        "name_jp": "ロサレダ",
        "name_es": "Rosaleda",
        "type": "フローラル・スパイシー",
        "story": "レティーロ公園のバラ園。水連の池やニンフに囲まれた、ローズオットーが主役の華やかな庭園のシンフォニーをイメージ。",
        "ingredients": ["ベルガモット", "ビターオレンジ", "アップル", "ピーチ", "バイオレット", "サンバックジャスミン", "ローズオットー", "ダマスクローズ", "ネロリ", "シダー", "アンバー", "ムスク"]
    },
    {
        "name_jp": "サン・ミゲル",
        "name_es": "San Miguel",
        "type": "フローラル・ウッディ",
        "story": "活気あふれるサン・ミゲル市場。鉄骨構造の下で、ローズエキスやパチョリ、アンバーが混ざり合う、エネルギッシュな街の個性を映した香り。",
        "ingredients": ["ベルガモット", "バイオレット", "ゼラニウム", "ローズエキス", "ダバナ", "パチョリ", "ベチバー", "アンバー", "トルーバルサム"]
    },
    {
        "name_jp": "プラド",
        "name_es": "Prado",
        "type": "アロマティック・ウッディ・アンバー",
        "story": "プラド美術館と『草原』へのオマージュ。風景画のような調和をもたらす、カモミールやセージが織りなす楽園のような香り。",
        "ingredients": ["カモミール", "クラリセージ", "カシス", "ライチ", "ロエベ アコード"]
    },
    {
        "name_jp": "カサ・デ・カンポ",
        "name_es": "Casa de Campo",
        "type": "ウッディ・フローラル・ムスキー",
        "story": "かつての王室狩猟地であり市民の憩いの場。自然の中での休息を想起させる、アルテミシアやサンダルウッドの穏やかな香り。",
        "ingredients": ["グリーンマンダリン", "ブラッドオレンジ", "アルテミシア", "サンダルウッド", "ムスク", "ロエベ アコード"]
    }
]

# 全香料のユニークなリストを作成
all_ingredients = sorted(list(set([ing for p in perfumes for ing in p["ingredients"]])))

# UIの構築
st.title("LOEWE Un Paseo Por Madrid")
st.caption("ロエベ：マドリードへの散歩 シリーズ 逆引き検索")

st.markdown("""
ロエベの故郷マドリードのスポットを巡るコレクション。  
**お好みの香料**を選択して、ぴったりの一本を見つけましょう。
---
""")

# サイドバーでの検索設定
st.sidebar.header("検索フィルター")
selected_ings = st.sidebar.multiselect(
    "好きな香料を選択してください（複数可）",
    options=all_ingredients,
    help="選択した香料が含まれる香水が表示されます。"
)

# 表示ロジック
if selected_ings:
    st.subheader(f"「{', '.join(selected_ings)}」を含むフレグランス")
    found_any = False
    for p in perfumes:
        if any(ing in p["ingredients"] for ing in selected_ings):
            found_any = True
            with st.expander(f"✨ {p['name_jp']} ({p['name_es']})"):
                st.write(f"**【香調】** {p['type']}")
                st.write(f"**【物語】** {p['story']}")
                st.write(f"**【主要香料】** {', '.join(p['ingredients'])}")
    if not found_any:
        st.info("該当する香水は見つかりませんでした。他の香料を試してみてください。")
else:
    st.subheader("シリーズ全9種類")
    for p in perfumes:
        with st.expander(f"{p['name_jp']} ({p['name_es']})"):
            st.write(f"**香調:** {p['type']}")
            st.write(f"**ストーリー:** {p['story']}")
            st.caption(f"香料: {', '.join(p['ingredients'])}")

# シリーズ共通の紹介文
st.markdown("---")
st.info("""
**LOEWE Un Paseo Por Madrid シリーズについて** ブランドの歴史的な本拠地であるマドリードの活気あるライフスタイルと文化にインスパイアされたユニセックスフレグランスコレクションです。それぞれの香りが、スペインの首都のさまざまな場所を巡る香りの旅へと誘います。
""")
